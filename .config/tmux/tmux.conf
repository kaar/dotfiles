# ================
# = KEY BINDINGS =
# ================

# Prefix - Ctrl-space
set -g prefix C-Space

# Reload config - Prefix + r
bind r {
    source-file ~/.config/tmux/tmux.conf
    display "Config reloaded"
}

# Split panes - | and -
bind | { split-window -h -c "#{pane_current_path}"}
bind - { split-window -v -c "#{pane_current_path}"}


# Resize panes
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Window navigation
bind -n M-h previous-window
bind -n M-l next-window
bind -n M-1 select-window -t 1
bind -n M-2 select-window -t 2
bind -n M-3 select-window -t 3
bind -n M-4 select-window -t 4
bind -n M-5 select-window -t 5
bind -n M-6 select-window -t 6
bind -n M-7 select-window -t 7
bind -n M-8 select-window -t 8
bind -n M-9 select-window -t 9
bind C-Space last-window

# Unbind default bindings
unbind C-b
unbind '"'
unbind %

# Session navigation
unbind f
bind f display-popup -E "t-sessions"

# Copy mode keybindings
setw -g mode-keys vi
bind-key -T copy-mode-vi v send -X begin-selection
bind-key -T copy-mode-vi y send -X copy-pipe-and-cancel "clip"
unbind -T copy-mode-vi Enter
bind-key -T copy-mode-vi Enter send -X copy-pipe-and-cancel "clip"
unbind -T copy-mode-vi Space
bind -T copy-mode-vi Space send -X jump-again
bind-key -T copy-mode-vi 0 send -X back-to-indentation
bind y run 'tmux save-buffer - | clip '
bind C-y run 'tmux save-buffer - | clip '

# Default to incremental search in copy-mode
bind-key  -T copy-mode-vi / command-prompt -i -p "search down" "send -X search-forward-incremental \"%%%\""
bind-key  -T copy-mode-vi ? command-prompt -i -p "search up" "send -X search-backward-incremental "%%%""
bind-key / copy-mode\; command-prompt -i -p "search up" "send -X search-backward-incremental "%%%""


# ==================
# = BASIC SETTINGS =
# ==================
set -g mouse on                                           # Enable mouse support
set -g set-clipboard on                                   # Use system clipboard
set -g display-time 2000                                  # Show messages longer
set -g focus-events                                       # form vim/tmux d/y buffer sync
set -g status-keys              vi                        # vi for command status
set -g automatic-rename         on
set -g automatic-rename-format  '#{b:pane_current_path}'  # use current path as window name
set -g default-shell            "$SHELL"
# Better terminal support - tmux-256color provides better tmux integration than xterm-256color
# and the terminal-overrides ensures true color support works with any 256-color terminal
set -g default-terminal         "tmux-256color"
set -ga terminal-overrides      ",*256col*:Tc"
set -g base-index               1                         # start windows from 1
set -g pane-base-index          1                         # start panes from 1
set -g renumber-windows         on                        # renumber windows automatically
set -g monitor-activity         on                        # show activity in background windows
set -s escape-time              0                         # reduce vim mode switching delay
set -g history-limit            30000                     # increase history limit


# =====================
# = VISUAL APPEARANCE =
# =====================
set -g status           on
set -g status-interval  30
set -g status-justify   centre
set -g status-keys      vi
set -g status-position  bottom

# Window status format and style
setw -g window-status-format          '#I:#W'
setw -g window-status-current-format  '#[bg=green,fg=black,bold] #I:#W '
setw -g window-status-style           'fg=#ebdbb2,bg=#282828'
setw -g window-status-current-style   'fg=#282828,bg=#ebdbb2'

# Makes borders invisible - matching background
set -g pane-border-style              'fg=#282828,bg=#282828'
set -g pane-active-border-style       'fg=#282828,bg=#282828'
set -g status-style                   'fg=#ebdbb2,bg=#282828'

# Status line left and right
set -g status-left                    '#[fg=green]#S '
set -g status-right                   ''


# ===========
# = PLUGINS =
# ===========

# Core plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'christoomey/vim-tmux-navigator'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'sainnhe/tmux-fzf'

# tmux-fzf configuration
set -g @fzf-url-fzf-options '-p 60%,30% --prompt="   " --border-label=" Open URL "'
set -g @fzf-url-history-limit '2000'

# Plugin installation:
# git clone https://github.com/tmux-plugins/tpm ~/.config/tmux/plugins/tpm
# Then: prefix + I to install plugins
run -b ~/.config/tmux/plugins/tpm/tpm
